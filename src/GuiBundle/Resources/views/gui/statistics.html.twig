{% extends '@Gui/base.html.twig' %}

{% block title %}Statistics{% endblock %}

{% block content %}
    <div class="row">
        <div class="col s6">
            <div class="statistics">
                <h5>General Statistics</h5>
                <div class="row">
                    <div class="col s9">
                        <b>Discovered links</b>
                    </div>
                    <div class="col s3">{{ no_of_links }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Visited links</b>
                    </div>
                    <div class="col s3">{{ visited_links }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Discovered images</b>
                    </div>
                    <div class="col s3">{{ discovered_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Images w/ Location in metadata</b>
                    </div>
                    <div class="col s3">{{ images_with_exif_location }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Images w/o Location in metadata</b>
                    </div>
                    <div class="col s3">{{ images_without_exif_location }}</div>
                </div>
            </div>
        </div>
        <div class="col s6">
            <div class="statistics">
                <h5>Geoparsing Statistics</h5>
                <div class="row">
                    <div class="col s9">
                        <b>Successful geoparsed</b>
                    </div>
                    <div class="col s3">{{ successful_geoparsed_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Unsuccessful geoparsed</b>
                    </div>
                    <div class="col s3">{{ unsuccessful_geoparsed_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Correct</b>
                    </div>
                    <div class="col s3">{{ correct_location_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Incorrect</b>
                    </div>
                    <div class="col s3">{{ incorrect_location_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Unverified</b>
                    </div>
                    <div class="col s3">{{ unverified_location_images }}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col s6">
            <div class="statistics">
                <h5>Regional Statistics</h5>
                <div class="row">
                    <div class="col s9">
                        <b>Africa</b>
                    </div>
                    <div class="col s3">{{ africa_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Antarctic</b>
                    </div>
                    <div class="col s3">{{ antarctic_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Asia</b>
                    </div>
                    <div class="col s3">{{ asia_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Oceania</b>
                    </div>
                    <div class="col s3">{{ oceania_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>Europe</b>
                    </div>
                    <div class="col s3">{{ europe_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>North America</b>
                    </div>
                    <div class="col s3">{{ na_images }}</div>
                </div>
                <div class="row">
                    <div class="col s9">
                        <b>South America</b>
                    </div>
                    <div class="col s3">{{ sa_images }}</div>
                </div>
                <div class="row">
                    <small>
                        <i>
                            * Regional statistics are not 100% accurate due to rectangle
                            bounding box coordinates used for querying images for calculation
                        </i>
                    </small>
                </div>
            </div>
        </div>
        <div class="col s6">
            <div class="statistics">
                <div id="chart"></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col s12">
            <h5>Address Statistics</h5>
            <div>
                <b>Total number of address: </b> {{ no_of_address_images }}
            </div>
            <div>
                <b>Number of address from metadata: </b> {{ no_of_address_images_in_metadata }}
            </div>
            <div>
                <b>Number of address from geoparsing: </b> {{ no_of_address_images_nin_metadata }}
            </div>
            <table class="table responsive-table highlight striped">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Address</th>
                    <th>No. of images</th>
                </tr>
                </thead>
                <tbody>
                {% for data in address_images %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ data.address }}</td>
                        <td>{{ data.no_of_images }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Title');
            data.addColumn('number', 'Statistic');
            data.addRows([
                ['Geocoded', {{ images_with_exif_location }}],
                ['Successful geoparsed', {{ successful_geoparsed_images }}],
                ['Unsuccessful geoparsed', {{ unsuccessful_geoparsed_images }}],
                ['Unhandled', {{ images_without_exif_location - (successful_geoparsed_images + unsuccessful_geoparsed_images) }}]
            ]);

            // Set chart options
            var options = {
                'title':'Handling of crawling results',
                'width':600,
                'height':400
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.PieChart(document.getElementById('chart'));
            chart.draw(data, options);
        }
    </script>
{% endblock %}

{% block footer %}
{% endblock %}